{
  "assets": {
    "ExternalTfsEndpoint": {
      "type": "endpoint:ExternalTfs",
      "inputs": {
        "token": "{{assets.PatToken}}"
      }
    }
  },
  "releaseDefinition": {
    "environments": [{
      "name": "dev",
      "deployedResourceIds": [
        "/subscriptions/{{inputs.subscriptionId}}/resourceGroups/{{inputs.resourceGroup}}/providers/Microsoft.Compute/virtualMachines/{{inputs.vmName}}"
      ],
      "variables": {
        "vmPassword": {
          "value": "{{{inputs.vmPassword}}}",
          "isSecret": true
        }
      },
      "templateFile": "Files/ReleaseDefinitionTemplates/deployAzureLinuxVirtualMachine.json",
      "phaseInputs": [{
          "queue": "HostedLinuxPreview",
          "taskInputs": [{
            "__TaskId__": "94a74903-f93f-4075-884f-dc11f34058b4",
            "ConnectedServiceName": "{{{assets.ARMEndpoint}}}",
            "ResourceGroupName": "{{{inputs.resourceGroup}}}",
            "location": "{{{inputs.vmlocation}}}",
            "csmFile": "https://raw.githubusercontent.com/michaeljqzq/devops-iot-sample/arm/arm-linux-vm.json",
            "overrideParameters": "-edgeDeviceConnectionString $(CS_OUTPUT) -virtualMachineName \"{{{inputs.vmName}}}\" -adminUsername \"{{{inputs.vmUsername}}}\" -adminPassword \"$(vmPassword)\" -appInsightsLocation \"{{{inputs.appInsightLocation}}}\" -virtualMachineSize \"{{{inputs.vmSize}}}\" -location \"{{{inputs.vmlocation}}}\" ",
            "deploymentGroupEndpoint": "{{{assets.ExternalTfsEndpoint}}}",
            "project": "{{{system.project}}}",
            "deploymentGroupName": "{{inputs.vmName}}-dg"
          }]
        },
        {
          "queue": "{{assets.DeploymentGroup}}"
        }
      ]
    }]
  }
}