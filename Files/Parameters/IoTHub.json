{
  "groups": [
    {
      "id": "iotHub",
      "name": "IoT Hub of Edge device",
      "properties": {
        "context": "service"
      }
    }
  ],
  "inputs": [
    {
      "id": "iotHubName",
      "type": "string",
      "description": "Name of IoT Hub to be created",
      "Name": "IoT Hub name",
      "inputMode": "TextBox",
      "groupId": "iotHub",
      "isRequired": true,
      "defaultValue": "IotHub1",
      "properties": {
        "attributes": "primary;"
      },
      "staticValidation": {
        "pattern": "[a-zA-Z0-9\\-]*",
        "errorMessage": "The value must contain only alphanumeric characters or the following: -",
        "minLength": 3,
        "maxLength": 15
      },
      "dynamicValidations": [
        {
          "dataSourceId": "checkIotHubAvailability",
          "errorMessage": "IoT Hub with this name already exists"
        }
      ]
    },
    {
      "id": "iotHubSku",
      "type": "string",
      "description": "Details of cost and compute resource associated with the IoT Hub",
      "name": "Pricing tier",
      "inputMode": "Combo",
      "groupId": "iotHub",
      "isRequired": true,
      "possibleValues": [
        {
          "value": "S1 Standard",
          "displayValue": "S1"
        },
        {
          "value": "S2 Standard",
          "displayValue": "S2"
        },
        {
          "value": "S3 Standard",
          "displayValue": "S3"
        },
        {
          "value": "B1 Basic",
          "displayValue": "B1"
        },
        {
          "value": "B2 Basic",
          "displayValue": "B2"
        },
        {
          "value": "B3 Basic",
          "displayValue": "B3"
        },
        {
          "value": "F1 Free",
          "displayValue": "F1 https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-scaling"
        }
      ],
      "defaultValue": "S1 Standard",
      "properties": {
        "attributes": "summarizable;"
      }
    },
    {
      "id": "accessToken",
      "type": "secureString",
      "description": "AAD access token for VSTS.",
      "inputMode": "AadAccessToken"
    },
    {
      "id": "tenantId",
      "type": "string",
      "description": "AAD tenant id.",
      "inputMode": "TenantId"
    }
  ],
  "dataSources": [
    {
      "id": "iotHubLocations",
      "endpointUrlStem": "/subscriptions/{{{inputs.subscriptionId}}}/providers/Microsoft.Devices?api-version=2018-02-01",
      "resultSelector": "$.resourceTypes[?(@.resourceType === 'IotHubs')].locations"
    },
    {
      "id": "checkIotHubAvailability",
      "endpointUrlStem": "/{{{inputs.subscriptionId}}}/providers/Microsoft.Devices/checkNameAvailability?api-version=2018-02-01",
      "httpMethod": "POST",
      "requestBody": "\\{\\\"name\\\":\\\"{{{inputs.iotHubName}}}\\\"\\}"
    }
  ]
}