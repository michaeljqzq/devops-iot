{
    "id": "Containers",
    "name": "Build Containers",
    "category": "Build",
    "iconTaskId": "e28912f1-0114-4464-802a-a3a35437fd16",
    "description": "Build container applications and push them to container registry.",
    "template": {
        "buildNumberFormat": "$(date:yyyyMMdd)$(rev:.r)",
        "process": {
            "type": 1,
            "phases": [
                {
                    "steps": [
                        {
                            "environment": {},
                            "enabled": true,
                            "continueOnError": false,
                            "alwaysRun": false,
                            "displayName": "Azure Deployment:Create Azure Container Registry",
                            "timeoutInMinutes": 0,
                            "condition": "succeeded()",
                            "task": {
                                "id": "94a74903-f93f-4075-884f-dc11f34058b4",
                                "versionSpec": "2.*",
                                "definitionType": "task"
                            },
                            "inputs": {
                                "ConnectedServiceName": "",
                                "action": "Create Or Update Resource Group",
                                "resourceGroupName": "",
                                "location": "",
                                "templateLocation": "Linked artifact",
                                "csmFileLink": "",
                                "csmParametersFileLink": "",
                                "csmFile": "",
                                "csmParametersFile": "",
                                "overrideParameters": "",
                                "deploymentMode": "Incremental",
                                "enableDeploymentPrerequisites": "None",
                                "deploymentGroupEndpoint": "",
                                "project": "",
                                "deploymentGroupName": "",
                                "copyAzureVMTags": "true",
                                "runAgentServiceAsUser": "false",
                                "userName": "",
                                "password": "",
                                "outputVariable": "",
                                "deploymentOutputs": ""
                            }
                        },
                        {
                            "environment": {},
                            "enabled": true,
                            "continueOnError": false,
                            "alwaysRun": false,
                            "displayName": "Build an image",
                            "timeoutInMinutes": 0,
                            "task": {
                                "id": "e28912f1-0114-4464-802a-a3a35437fd16",
                                "versionSpec": "1.*",
                                "definitionType": "task"
                            },
                            "inputs": {
                                "containerregistrytype": "Azure Container Registry",
                                "dockerRegistryEndpoint": "",
                                "azureSubscriptionEndpoint": "",
                                "azureContainerRegistry": "",
                                "command": "Build an image",
                                "dockerFile": "**/Dockerfile",
                                "arguments": "",
                                "useDefaultContext": "true",
                                "buildContext": "",
                                "pushMultipleImages": "false",
                                "tagMultipleImages": "false",
                                "imageName": "$(Build.Repository.Name):$(Build.BuildId)",
                                "imageNamesPath": "",
                                "qualifyImageName": "true",
                                "includeSourceTags": "false",
                                "includeLatestTag": "false",
                                "imageDigestFile": "",
                                "containerName": "",
                                "ports": "",
                                "volumes": "",
                                "envVars": "",
                                "workingDirectory": "",
                                "entrypointOverride": "",
                                "containerCommand": "",
                                "runInBackground": "true",
                                "restartPolicy": "no",
                                "maxRestartRetries": "",
                                "dockerHostEndpoint": "",
                                "enforceDockerNamingConvention": "true",
                                "memoryLimit": ""
                            }
                        },
                        {
                            "environment": {},
                            "enabled": true,
                            "continueOnError": false,
                            "alwaysRun": false,
                            "displayName": "Push an image",
                            "timeoutInMinutes": 0,
                            "task": {
                                "id": "e28912f1-0114-4464-802a-a3a35437fd16",
                                "versionSpec": "1.*",
                                "definitionType": "task"
                            },
                            "inputs": {
                                "containerregistrytype": "Azure Container Registry",
                                "dockerRegistryEndpoint": "",
                                "azureSubscriptionEndpoint": "",
                                "azureContainerRegistry": "",
                                "command": "Push an image",
                                "dockerFile": "**/Dockerfile",
                                "arguments": "",
                                "useDefaultContext": "true",
                                "buildContext": "",
                                "pushMultipleImages": "false",
                                "tagMultipleImages": "false",
                                "imageName": "$(Build.Repository.Name):$(Build.BuildId)",
                                "imageNamesPath": "",
                                "qualifyImageName": "true",
                                "includeSourceTags": "false",
                                "includeLatestTag": "false",
                                "imageDigestFile": "",
                                "containerName": "",
                                "ports": "",
                                "volumes": "",
                                "envVars": "",
                                "workingDirectory": "",
                                "entrypointOverride": "",
                                "containerCommand": "",
                                "runInBackground": "true",
                                "restartPolicy": "no",
                                "maxRestartRetries": "",
                                "dockerHostEndpoint": "",
                                "enforceDockerNamingConvention": "true",
                                "memoryLimit": ""
                            }
                        },
                        {
                            "enabled": true,
                            "continueOnError": false,
                            "alwaysRun": false,
                            "displayName": "Copy ARM templates",
                            "timeoutInMinutes": 0,
                            "task": {
                                "id": "5bfb729a-a7c8-4a78-a7c3-8d717bb7c13c",
                                "versionSpec": "2.*",
                                "definitionType": "task"
                            },
                            "inputs": {
                                "SourceFolder": "ArmTemplates",
                                "Contents": "**",
                                "TargetFolder": "$(build.artifactstagingdirectory)",
                                "CleanTargetFolder": "false",
                                "OverWrite": "false",
                                "flattenFolders": "false"
                            }
                        },
                        {
                            "enabled": true,
                            "alwaysRun": true,
                            "displayName": "Publish Artifact",
                            "inputs": {
                                "PathtoPublish": "$(build.artifactstagingdirectory)",
                                "ArtifactName": "drop",
                                "ArtifactType": "Container",
                                "TargetPath": "\\\\my\\share\\$(Build.DefinitionName)\\$(Build.BuildNumber)",
                                "Parallel": "false",
                                "ParallelCount": "8"
                            },
                            "task": {
                                "id": "2ff763a7-ce83-4e1f-bc89-0ae63477cebe",
                                "versionSpec": "1.*",
                                "definitionType": "task"
                            }
                        }
                    ]
                }
            ]
        },
        "variables": {
            "system.debug": {
                "value": "false",
                "allowOverride": true
            }
        },
        "triggers": [],
        "processParameters": {}
    }
}